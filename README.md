# bangbangbang

超新星遗迹重元素扩散的三维可视化模拟。  
本项目基于 Sedov–Taylor 自相似解，通过粒子方法追踪 Fe / Si / O / C 等重元素在超新星遗迹中的演化，并以“太空摄像机”的第一视角展示扩散过程。

---

## 1. 物理与数学原理

### 1.1 Sedov–Taylor 自相似解

考虑一个在**均匀介质**中的瞬时点爆炸：

- 爆炸能量：$E$，量纲 $[E] = \mathrm{ML^2T^{-2}}$
- 环境密度：$\rho_0$，量纲 $[\rho_0] = \mathrm{ML^{-3}}$
- 时间：$t$，量纲 $[t] = \mathrm{T}$

假设在能量守恒且无外部尺度的情况下，冲击波半径 $R(t)$ 只依赖于 $E$、$\rho_0$ 和 $t$，可以写成：

$$
R(t) \propto E^a \rho_0^b t^c
$$

对三个基本量纲（质量 M、长度 L、时间 T）分别配平：

- 长度 L：$1 = 2a - 3b$
- 时间 T：$0 = -2a + c$
- 质量 M：$0 = a + b$

解得：

$$
a = \frac{1}{5}, \quad b = -\frac{1}{5}, \quad c = \frac{2}{5}
$$

从而得到 Sedov–Taylor 标度律：

$$
R(t) = \beta \left( \frac{E}{\rho_0} \right)^{1/5} t^{2/5}
$$

其中 $\beta$ 是与绝热指数 $\gamma$ 有关的无量纲常数，对 $\gamma = 5/3$ 的单原子理想气体，数值上约为 $\beta \approx 1.15$。  

### 1.2 冲击波速度与温度的标度关系

由上式对时间求导，可以得到冲击波速度：

$$
v_{\text{shock}}(t)
= \frac{\mathrm{d}R}{\mathrm{d}t}
= \frac{2}{5} \beta \left( \frac{E}{\rho_0} \right)^{1/5} t^{-3/5}
$$

因此 $v_{\text{shock}} \propto t^{-3/5}$，即**随时间变慢**。

对于强激波，Rankine–Hugoniot 跳跃条件给出激波后的温度近似：

$$
T_{\text{shock}} \approx \frac{3}{16}
  \frac{\mu m_p}{k_B} v_{\text{shock}}^2
$$

其中：

- $\mu$：平均分子量（本项目取 $\mu \approx 0.6$，对应电离气体）
- $m_p$：质子质量
- $k_B$：玻尔兹曼常数

可以看到，**温度正比于激波速度的平方**。

在超新星遗迹内部，我们引入无量纲半径：

$$
\xi = \frac{r}{R(t)}, \quad 0 \le \xi \le 1
$$

并采用一个简单的剖面假设：

$$
T(\xi) \propto T_{\text{shock}} (1 - \xi)^{1/2}
$$

用来体现壳内部气体逐渐冷却、中心更热的趋势。这不是精确解，但形状与更严格的数值解相似。

### 1.3 密度与速度剖面的近似形式

严格的 Sedov–Taylor 解会给出密度 $\rho(\xi)$、速度 $v(\xi)$ 的自相似剖面，它们满足一组来自 Euler 方程的常微分方程。这里为了用于可视化、保持计算简单，我们做了两个近似：

1. **速度剖面 $v(\xi)$**  
   - 在靠近中心（$\xi$ 小）时速度较小；
   - 在接近冲击波前沿（$\xi \to 1$）时逐渐接近激波速度。
   - 用一个分段多项式进行拟合，确保整体是平滑递减的。

2. **密度剖面 $\rho(\xi)$**  
   - 使用依赖于绝热指数 $\gamma$ 的解析近似，将自相似解中“前高后低”的趋势用幂律表达出来；
   - 重点是形状合理（中心略高，冲击波附近更高），而不是完全精确。

### 1.4 重元素粒子与扩散模型

为了可视化不同元素的扩散，我们将抛射物的化学组成离散为大量“代表粒子”：

- 每个粒子携带：
  - 元素：`Fe`, `Si`, `O`, `C`
  - 质量 $m$（与质量数 $A$ 成比例）
  - 扩散系数 $D$（重元素通常扩散得更慢）
  - 自相似坐标：$(\xi, \theta, \phi)$
  - 实际坐标：$(x, y, z)$，单位 pc

每一个时间步长 $\Delta t$ 中，粒子经历两个过程叠加：

1. **随壳膨胀的“有序”运动**  
   - 径向速度来自自相似剖面：$v_r(\xi) = v_{\text{shock}}(t) f_v(\xi)$；
   - 粒子沿当前方向向外推进一段距离。

2. **随机扩散（湍流/混合的简化）**  
   - 扩散长度近似服从：
     $$
     \Delta r_{\text{diff}} \sim \sqrt{2D\Delta t}
     $$
   - 在代码里，我们在一个随机方向上给粒子施加这样大小的扰动，等价于一个各向同性的随机游走。

经过多步迭代后，不同元素的粒子会形成一个既有壳结构、又有一定混合的分布，这就是你在动画中看到的彩色粒子云。

---

## 2. 数值实现与可视化方式

### 2.1 三维空间中的壳层

- 粒子真正生活在三维空间中，有 $(x,y,z)$ 三个坐标；
- 冲击波半径 $R(t)$ 决定了壳的大致大小，粒子的无量纲半径 $\xi = r/R(t)$ 控制它在壳内的位置；
- 每个时间步更新 $\xi$、角度，并同步更新 $(x,y,z)$。

### 2.2 “摄像机”视角与投影

可视化时，我们做了一件事情：**把一个虚拟摄像机放在远处，朝向爆炸中心**。

1. 用户通过两个角度控制摄像机方向：
   - 方位角（水平绕 $z$ 轴旋转）；
   - 仰角（上下俯仰）。

2. 对每个粒子的 $(x,y,z)$：
   - 先绕 $z$ 轴旋转：模拟摄像机水平环绕；
   - 再绕 $x$ 轴旋转：模拟抬头/低头；
   - 最后做一个简单的“透视缩放”，让离摄像机更远的粒子稍微缩小。

3. 把旋转后的 $(x', y', z')$ 映射到屏幕上的 $(x_{\mathrm{screen}}, y_{\mathrm{screen}})$：
   - 使用统一的空间尺度，把 $\pm \text{viewRange}$ 压到屏幕的中心一个正方形区域；
   - 无论浏览器窗口长宽比如何，冲击波壳都会保持圆形，而不是被拉成椭圆。

---

## 3. 使用说明（如何运行、如何操作）

### 3.1 运行环境要求

- 可以访问 D3.js 官方 CDN：
  - `https://d3js.org/d3.v7.min.js`

### 3.2 本地运行步骤

1. **克隆或下载仓库**

  
   git clone https://github.com/your-username/bangbangbang.git
   cd bangbangbang
      或者在 GitHub 页面点击 “Code → Download ZIP”，下载后解压。

2. **用浏览器打开入口页面**

   python -m http.server 8000

3. **看到的内容**

   - 整个窗口是一个深色的宇宙背景；
   - 中央是不断膨胀的多彩粒子云和冲击波圆环；
   - 左上角有一小块文字 HUD：
     - 时间（年）
     - 冲击波半径（pc）
     - 平均温度（K）
   - 右下角有一排小控件（按钮 + 滑块）。

---

## 4. 仓库结构一览

- `nova-model.js`：Sedov–Taylor 模型与三维粒子更新逻辑（核心物理）。
- `data-manager.js`：对粒子数据做统计（径向/角向分布、时间序列等，目前主要用于内部计算）。
- `visualization.js`：D3.js 可视化、三维投影和摄像机视角控制。
- `main.js`：主模拟控制器，串联模型、数据和可视化，并负责 UI 交互。
- `index.html`：浏览器入口页面。
- `styles.css`：深空主题样式和 HUD 控件布局。
